// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    output   = "../generated/prisma"
}

datasource db {
    provider = "sqlite"
    url      = "file:./dev.db"
}

model Job {
    id           String    @id @default(cuid())
    description  String
    location     String
    status       JobStatus @default(PLANNING)
    cost         Decimal
    contractorId String    @map("contractor_id")
    homeownerId  String?   @map("homeowner_id")

    contractor User      @relation("ContractorJobs", fields: [contractorId], references: [id])
    homeowner  User?     @relation("HomeownerJobs", fields: [homeownerId], references: [id])
    messages   Message[]

    @@map("jobs")
}

model Message {
    id        String   @id @default(cuid())
    text      String
    createdAt DateTime @default(now()) @map("created_at")
    jobId     String   @map("job_id")
    senderId  String   @map("sender_id")

    job    Job  @relation(fields: [jobId], references: [id])
    sender User @relation("UserMessages", fields: [senderId], references: [id])

    @@index([createdAt])
    @@map("messages")
}

model User {
    id             String    @id @default(cuid())
    username       String    @unique
    password       String
    role           UserRole
    contractorJobs Job[]     @relation("ContractorJobs")
    homeownerJobs  Job[]     @relation("HomeownerJobs")
    messages       Message[] @relation("UserMessages")

    @@map("users")
}

enum JobStatus {
    PLANNING    @map("planning")
    IN_PROGRESS @map("in_progress")
    COMPLETED   @map("completed")
    CANCELED    @map("canceled")
}

enum UserRole {
    CONTRACTOR @map("contractor")
    HOMEOWNER  @map("homeowner")
}
